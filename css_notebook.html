<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSS Styling Notebook</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f8f9fa;
            color: #212529;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            border-bottom: 1px solid #dee2e6;
            padding: 12px 24px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .toolbar {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
        }

        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn.primary {
            background: rgba(255,255,255,0.9);
            color: #e74c3c;
        }

        .btn.primary:hover {
            background: white;
            color: #c0392b;
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid #dee2e6;
            padding: 16px;
            overflow-y: auto;
            flex-shrink: 0;
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 2px 0 8px rgba(0,0,0,0.05);
            margin-left: -280px;
        }

        .sidebar.open {
            margin-left: 0;
        }

        .sidebar-toggle {
            position: absolute;
            left: 0px;
            top: 100px;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 8px;
            cursor: pointer;
            border-radius: 0 6px 6px 0;
            font-size: 14px;
            z-index: 100;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 2px 2px 8px rgba(0,0,0,0.15);
        }

        .sidebar.open + .sidebar-toggle {
            left: 280px;
        }

        .sidebar-toggle:hover {
            background: #c0392b;
            transform: translateX(2px);
        }

        .sidebar h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #495057;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .template-category {
            margin-bottom: 20px;
        }

        .template-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .template-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            transition: all 0.2s ease;
            text-align: left;
            width: 100%;
        }

        .template-item:hover {
            background: #e74c3c;
            color: white;
            transform: translateX(4px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .explanation-banner {
            background: linear-gradient(135deg, #fff5f5 0%, #ffe6e6 100%);
            border-bottom: 1px solid #fecaca;
            padding: 16px 20px;
            font-size: 13px;
            line-height: 1.5;
            display: none;
            box-shadow: inset 0 -1px 0 rgba(0,0,0,0.05);
        }

        .explanation-banner.show {
            display: block;
        }

        .explanation-banner h4 {
            color: #c0392b;
            margin-bottom: 8px;
            font-size: 15px;
            font-weight: 600;
        }

        .notebook-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .cell-group {
            background: white;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            overflow: hidden;
            border: 1px solid #dee2e6;
        }

        .cell-group.selected {
            border-left: 4px solid #e74c3c;
            box-shadow: 0 4px 16px rgba(231, 76, 60, 0.15);
        }

        .cell-group-header {
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .cell-group-title {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .cell-group-toolbar {
            display: flex;
            gap: 4px;
        }

        .cell-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 3px;
            padding: 4px 8px;
            font-size: 10px;
            cursor: pointer;
            color: #495057;
            transition: all 0.2s ease;
        }

        .cell-btn:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .cell-btn.run {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .cell-btn.run:hover {
            background: #218838;
        }

        .cell-btn.delete {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .cell-btn.delete:hover {
            background: #c82333;
        }

        .cell-row {
            display: flex;
            min-height: 80px;
        }

        .cell-half {
            flex: 1;
            border-right: 1px solid #dee2e6;
            display: flex;
            flex-direction: column;
        }

        .cell-half:last-child {
            border-right: none;
        }

        .cell-label {
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            padding: 8px 12px;
            font-size: 11px;
            font-weight: 600;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .html-section .cell-label {
            background: #e3f2fd;
            color: #1565c0;
        }

        .css-section .cell-label {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .cell-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .cell-editor {
            border: none;
            padding: 12px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 14px;
            line-height: 1.4;
            resize: none;
            height: auto;
            min-height: 120px;
            width: 100%;
            background: transparent;
            outline: none;
            color: #212529;
        }

        .cell-editor:focus {
            background: #fefefe;
        }

        .cell-output {
            border-top: 1px solid #dee2e6;
            background: #fefefe;
            min-height: 60px;
            display: none;
        }

        .cell-output.has-content {
            display: block;
        }

        .cell-output iframe {
            width: 100%;
            border: none;
            background: white;
            display: block;
            min-height: 200px;
        }

        .add-cell {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            cursor: pointer;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            margin-bottom: 20px;
            background: white;
            transition: all 0.2s ease;
            font-size: 15px;
            font-weight: 500;
        }

        .add-cell:hover {
            border-color: #e74c3c;
            background: #fff5f5;
            color: #e74c3c;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 250px;
                margin-left: -250px;
            }
            
            .sidebar.open + .sidebar-toggle {
                left: 250px;
            }
            
            .cell-row {
                flex-direction: column;
            }
            
            .cell-half {
                border-right: none;
                border-bottom: 1px solid #dee2e6;
            }
            
            .cell-half:last-child {
                border-bottom: none;
            }
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">CSS Styling Notebook</div>
        <div class="toolbar">
            <button class="btn primary" onclick="NotebookAPI.addCellGroup()">+ New Style</button>
            <button class="btn" onclick="NotebookAPI.runAll()">▶ Apply All</button>
            <button class="btn" onclick="NotebookAPI.clearOutputs()">Clear</button>
            <button class="btn" onclick="NotebookAPI.download()">Export</button>
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar" id="sidebar">
            <div class="template-category">
                <h3>🌟 Start Here - Basics</h3>
                <div class="template-list">
                    <span class="template-item" onclick="TemplateManager.loadTemplate('body')">Body & Background</span>
                    <span class="template-item" onclick="TemplateManager.loadTemplate('text')">Text Styling</span>
                    <span class="template-item" onclick="TemplateManager.loadTemplate('div')">Div Boxes</span>
                </div>
            </div>

            <div class="template-category">
                <h3>📝 Simple Elements</h3>
                <div class="template-list">
                    <span class="template-item" onclick="TemplateManager.loadTemplate('list')">Lists</span>
                    <span class="template-item" onclick="TemplateManager.loadTemplate('table')">Tables</span>
                    <span class="template-item" onclick="TemplateManager.loadTemplate('hr')">Lines (HR)</span>
                </div>
            </div>

            <div class="template-category">
                <h3>🎯 Interactive</h3>
                <div class="template-list">
                    <span class="template-item" onclick="TemplateManager.loadTemplate('button')">Buttons</span>
                    <span class="template-item" onclick="TemplateManager.loadTemplate('form')">Forms</span>
                </div>
            </div>

            <div class="template-category">
                <h3>📐 Layouts</h3>
                <div class="template-list">
                    <span class="template-item" onclick="TemplateManager.loadTemplate('flexbox')">Flexbox</span>
                </div>
            </div>
        </div>

        <button class="sidebar-toggle" onclick="SidebarManager.toggle()">☰</button>

        <div class="content-area">
            <div class="explanation-banner" id="explanation">
                <h4 id="explanation-title">Welcome to CSS Styling Notebook</h4>
                <div id="explanation-text">Select a template from the sidebar to start styling existing HTML elements. The left side shows HTML structure, the right side shows your CSS styles.</div>
            </div>

            <div class="notebook-container">
                <div id="notebook">
                    <!-- Cell groups will be added here -->
                </div>
                <div class="add-cell" onclick="NotebookAPI.addCellGroup()">
                    + Click to add a new styling experiment
                </div>
            </div>
        </div>
    </div>

    <script>
        // HTML Templates Database - Beginner Friendly
        const HTMLTemplatesDB = {
            // BASICS - Start Here
            body: {
                title: "Body & Background",
                description: "Learn to style the page background with colors, gradients, and fonts.",
                html: `<body>
  <p>This text sits on the styled background</p>
</body>`,
                css: `body {
  background-color: lightblue;
  font-family: Arial, sans-serif;
  margin: 20px;
  padding: 20px;
}`
            },

            text: {
                title: "Text Styling",
                description: "Basic text properties: color, size, weight, and alignment.",
                html: `<h1>Big Heading</h1>
<p>Normal paragraph text</p>
<p class="special">Special styled text</p>`,
                css: `h1 {
  color: red;
  font-size: 32px;
}

p {
  color: blue;
  font-size: 16px;
}

.special {
  color: green;
  font-weight: bold;
  text-align: center;
}`
            },

            table: {
                title: "Simple Table",
                description: "Style tables with borders, colors, and spacing.",
                html: `<table>
  <tr>
    <th>Name</th>
    <th>Age</th>
  </tr>
  <tr>
    <td>John</td>
    <td>25</td>
  </tr>
  <tr>
    <td>Jane</td>
    <td>30</td>
  </tr>
</table>`,
                css: `table {
  border: 2px solid black;
  width: 100%;
}

th, td {
  border: 1px solid gray;
  padding: 10px;
  text-align: center;
}

th {
  background-color: lightgray;
  font-weight: bold;
}`
            },

            hr: {
                title: "Horizontal Lines",
                description: "Style horizontal rules with different colors, thickness, and styles.",
                html: `<p>Text before line</p>
<hr class="thick">
<p>Text between lines</p>
<hr class="colored">
<p>Text after line</p>`,
                css: `hr {
  border: 1px solid black;
  margin: 20px 0;
}

.thick {
  border: 4px solid blue;
}

.colored {
  border: 2px solid red;
  border-style: dashed;
}`
            },

            list: {
                title: "Lists",
                description: "Style ordered and unordered lists with colors and spacing.",
                html: `<ul>
  <li>First item</li>
  <li>Second item</li>
  <li>Third item</li>
</ul>

<ol class="special-list">
  <li>Step one</li>
  <li>Step two</li>
</ol>`,
                css: `ul {
  background-color: lightyellow;
  padding: 15px;
}

li {
  color: darkblue;
  margin-bottom: 5px;
}

.special-list {
  background-color: lightgreen;
  padding: 15px;
}

.special-list li {
  color: darkgreen;
  font-weight: bold;
}`
            },

            div: {
                title: "Div Boxes",
                description: "Create and style boxes with borders, backgrounds, and spacing.",
                html: `<div class="box1">First Box</div>
<div class="box2">Second Box</div>
<div class="box3">Third Box</div>`,
                css: `.box1 {
  background-color: red;
  color: white;
  padding: 20px;
  margin: 10px;
}

.box2 {
  background-color: blue;
  color: white;
  padding: 15px;
  border: 3px solid black;
  margin: 10px;
}

.box3 {
  background-color: green;
  color: white;
  padding: 25px;
  border-radius: 15px;
  margin: 10px;
  text-align: center;
}`
            },

            // INTERMEDIATE - Build Up Skills
            button: {
                title: "Button Styling",
                description: "Style buttons with colors, hover effects, and borders.",
                html: `<button>Normal Button</button>
<button class="fancy">Fancy Button</button>`,
                css: `button {
  padding: 10px 20px;
  font-size: 16px;
  background-color: lightblue;
  border: 2px solid blue;
  cursor: pointer;
}

button:hover {
  background-color: blue;
  color: white;
}

.fancy {
  background-color: purple;
  color: white;
  border-radius: 20px;
  border: none;
}`
            },

            form: {
                title: "Simple Form",
                description: "Style form inputs and labels for better appearance.",
                html: `<form>
  <label>Name:</label>
  <input type="text" placeholder="Your name">
  
  <label>Email:</label>
  <input type="email" placeholder="Your email">
  
  <button type="submit">Send</button>
</form>`,
                css: `form {
  background-color: #f0f0f0;
  padding: 20px;
  border-radius: 10px;
}

label {
  display: block;
  font-weight: bold;
  margin-top: 10px;
  color: #333;
}

input {
  width: 100%;
  padding: 8px;
  margin-top: 5px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

button {
  margin-top: 15px;
  padding: 10px 20px;
  background-color: green;
  color: white;
  border: none;
  border-radius: 5px;
}`
            },

            // ADVANCED - More Complex Layouts
            flexbox: {
                title: "Flexbox Basics",
                description: "Arrange items in rows and columns using flexbox.",
                html: `<div class="container">
  <div class="item">Box 1</div>
  <div class="item">Box 2</div>
  <div class="item">Box 3</div>
</div>`,
                css: `.container {
  display: flex;
  gap: 10px;
  padding: 20px;
  background-color: #f5f5f5;
}

.item {
  background-color: orange;
  color: white;
  padding: 20px;
  text-align: center;
  flex: 1;
  border-radius: 5px;
}`
            }
        };

        // Application State
        const AppState = {
            cellGroups: [],
            cellCounter: 0,
            selectedCellGroupId: null,
            sidebarOpen: false,
            
            save() {
                return {
                    cellGroups: this.cellGroups.map(group => ({
                        id: group.id,
                        title: group.title,
                        htmlContent: group.htmlEditor.value,
                        cssContent: group.cssEditor.value
                    })),
                    cellCounter: this.cellCounter
                };
            },
            
            load(data) {
                if (data) {
                    this.cellCounter = data.cellCounter || 0;
                }
            }
        };

        // Sidebar Management
        const SidebarManager = {
            toggle() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('open');
                AppState.sidebarOpen = sidebar.classList.contains('open');
            }
        };

        // Template Management System
        const TemplateManager = {
            loadTemplate(templateName) {
                const templateData = HTMLTemplatesDB[templateName];
                if (!templateData) return;

                this.showExplanation(templateData);
                this.loadInCellGroup(templateData);
            },

            showExplanation(templateData) {
                const banner = document.getElementById('explanation');
                const title = document.getElementById('explanation-title');
                const text = document.getElementById('explanation-text');
                
                title.textContent = templateData.title;
                text.textContent = templateData.description;
                banner.classList.add('show');
            },

            hideExplanation() {
                document.getElementById('explanation').classList.remove('show');
            },

            loadInCellGroup(templateData) {
                const targetGroup = AppState.selectedCellGroupId ? 
                    document.getElementById(AppState.selectedCellGroupId) : 
                    CellGroupManager.create(templateData.title);
                
                const htmlEditor = targetGroup.querySelector('.html-editor');
                const cssEditor = targetGroup.querySelector('.css-editor');
                
                htmlEditor.value = templateData.html;
                cssEditor.value = templateData.css;
                
                CellGroupManager.autoResize.call(htmlEditor);
                CellGroupManager.autoResize.call(cssEditor);
                
                htmlEditor.focus();
            }
        };

        // Cell Group Management System
        const CellGroupManager = {
            create(title = 'Untitled Style') {
                AppState.cellCounter++;
                const groupId = `cell-group-${AppState.cellCounter}`;
                
                const groupDiv = this.createElement(groupId, title);
                this.attachEvents(groupDiv, groupId);
                this.addToNotebook(groupDiv);
                
                const groupObj = {
                    id: groupId,
                    title: title,
                    element: groupDiv,
                    htmlEditor: groupDiv.querySelector('.html-editor'),
                    cssEditor: groupDiv.querySelector('.css-editor')
                };
                
                AppState.cellGroups.push(groupObj);
                UI.selectCellGroup(groupId);
                return groupDiv;
            },

            createElement(groupId, title) {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'cell-group';
                groupDiv.id = groupId;
                groupDiv.innerHTML = `
                    <div class="cell-group-header">
                        <div class="cell-group-title">${title}</div>
                        <div class="cell-group-toolbar">
                            <button class="cell-btn run" onclick="CodeRunner.runCellGroup('${groupId}')">▶ Apply</button>
                            <button class="cell-btn" onclick="CellGroupManager.moveUp('${groupId}')">↑</button>
                            <button class="cell-btn" onclick="CellGroupManager.moveDown('${groupId}')">↓</button>
                            <button class="cell-btn delete" onclick="CellGroupManager.delete('${groupId}')">×</button>
                        </div>
                    </div>
                    <div class="cell-row">
                        <div class="cell-half html-section">
                            <div class="cell-label">HTML Structure</div>
                            <div class="cell-content">
                                <textarea class="cell-editor html-editor" placeholder="Enter HTML structure..."></textarea>
                            </div>
                        </div>
                        <div class="cell-half css-section">
                            <div class="cell-label">CSS Styles</div>
                            <div class="cell-content">
                                <textarea class="cell-editor css-editor" placeholder="Enter CSS styles..."></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="cell-output"></div>
                `;
                return groupDiv;
            },

            attachEvents(groupDiv, groupId) {
                const htmlEditor = groupDiv.querySelector('.html-editor');
                const cssEditor = groupDiv.querySelector('.css-editor');
                
                htmlEditor.addEventListener('focus', () => UI.selectCellGroup(groupId));
                cssEditor.addEventListener('focus', () => UI.selectCellGroup(groupId));
                
                htmlEditor.addEventListener('input', this.autoResize);
                cssEditor.addEventListener('input', this.autoResize);
                
                this.autoResize.call(htmlEditor);
                this.autoResize.call(cssEditor);
            },

            autoResize() {
                this.style.height = 'auto';
                const minHeight = 120;
                const scrollHeight = Math.max(this.scrollHeight, minHeight);
                this.style.height = Math.min(scrollHeight, 400) + 'px';
            },

            addToNotebook(groupDiv) {
                const notebook = document.getElementById('notebook');
                notebook.appendChild(groupDiv);
                
                const htmlEditor = groupDiv.querySelector('.html-editor');
                htmlEditor.focus();
            },

            delete(groupId) {
                if (AppState.cellGroups.length <= 1) {
                    alert('Cannot delete the last cell group');
                    return;
                }
                
                const group = document.getElementById(groupId);
                group.remove();
                
                AppState.cellGroups = AppState.cellGroups.filter(g => g.id !== groupId);
                
                if (AppState.cellGroups.length > 0) {
                    UI.selectCellGroup(AppState.cellGroups[0].id);
                    AppState.cellGroups[0].htmlEditor.focus();
                }
            },

            moveUp(groupId) {
                const group = document.getElementById(groupId);
                const prev = group.previousElementSibling;
                if (prev && prev.classList.contains('cell-group')) {
                    group.parentNode.insertBefore(group, prev);
                }
            },

            moveDown(groupId) {
                const group = document.getElementById(groupId);
                const next = group.nextElementSibling;
                if (next && next.classList.contains('cell-group')) {
                    group.parentNode.insertBefore(next, group);
                }
            }
        };

        // Code Execution System
        const CodeRunner = {
            runCellGroup(groupId) {
                const group = document.getElementById(groupId);
                const htmlEditor = group.querySelector('.html-editor');
                const cssEditor = group.querySelector('.css-editor');
                const output = group.querySelector('.cell-output');
                
                const htmlCode = htmlEditor.value.trim();
                const cssCode = cssEditor.value.trim();
                
                if (!htmlCode && !cssCode) {
                    this.clearOutput(output);
                    return;
                }

                this.executeCode(output, htmlCode, cssCode);
            },

            executeCode(output, htmlCode, cssCode) {
                const iframe = document.createElement('iframe');
                iframe.style.width = '100%';
                iframe.style.border = 'none';
                iframe.style.display = 'block';
                
                output.innerHTML = '';
                output.classList.add('has-content');
                output.appendChild(iframe);
                
                const doc = iframe.contentDocument || iframe.contentWindow.document;
                doc.open();
                doc.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <style>
                            body { 
                                margin: 16px; 
                                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
                                font-size: 14px; 
                                line-height: 1.5;
                                background: white;
                            }
                            ${cssCode}
                        </style>
                    </head>
                    <body>
                        ${htmlCode}
                    </body>
                    </html>
                `);
                doc.close();

                setTimeout(() => this.adjustIframeHeight(iframe, doc), 200);
            },

            adjustIframeHeight(iframe, doc) {
                const contentHeight = doc.body.scrollHeight;
                iframe.style.height = Math.max(contentHeight + 32, 200) + 'px';
            },

            clearOutput(output) {
                output.innerHTML = '';
                output.classList.remove('has-content');
            },

            runAll() {
                AppState.cellGroups.forEach(group => {
                    this.runCellGroup(group.id);
                });
            },

            clearAllOutputs() {
                document.querySelectorAll('.cell-output').forEach(output => {
                    this.clearOutput(output);
                });
            }
        };

        // UI Management
        const UI = {
            selectCellGroup(groupId) {
                document.querySelectorAll('.cell-group').forEach(group => {
                    group.classList.remove('selected');
                });
                
                const group = document.getElementById(groupId);
                if (group) {
                    group.classList.add('selected');
                    AppState.selectedCellGroupId = groupId;
                }
            },

            deselectAll() {
                document.querySelectorAll('.cell-group').forEach(group => {
                    group.classList.remove('selected');
                });
                AppState.selectedCellGroupId = null;
            }
        };

        // Public API for toolbar buttons
        const NotebookAPI = {
            addCellGroup() {
                CellGroupManager.create();
                TemplateManager.hideExplanation();
            },

            runAll() {
                CodeRunner.runAll();
            },

            clearOutputs() {
                CodeRunner.clearAllOutputs();
            },

            download() {
                const notebookData = {
                    cellGroups: AppState.cellGroups.map(group => ({
                        title: group.title,
                        html: group.htmlEditor.value,
                        css: group.cssEditor.value
                    })),
                    metadata: {
                        created: new Date().toISOString(),
                        cellCount: AppState.cellCounter
                    }
                };
                
                const dataStr = JSON.stringify(notebookData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = 'css-notebook.json';
                link.click();
                
                URL.revokeObjectURL(url);
            }
        };

        // Application Initialization
        const App = {
            init() {
                this.setupEventListeners();
                this.loadInitialState();
                this.createFirstCellGroup();
                this.showWelcome();
            },

            setupEventListeners() {
                document.addEventListener('keydown', (event) => {
                    if (event.key === 'Escape') {
                        UI.deselectAll();
                        TemplateManager.hideExplanation();
                    }
                    
                    if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {
                        if (AppState.selectedCellGroupId) {
                            CodeRunner.runCellGroup(AppState.selectedCellGroupId);
                        }
                    }
                });
                
                document.addEventListener('click', (event) => {
                    if (!event.target.closest('.cell-group') && !event.target.closest('.add-cell')) {
                        UI.deselectAll();
                    }
                });
            },

            loadInitialState() {
                // In a real app with localStorage, we'd load saved state here
                // AppState.load(JSON.parse(localStorage.getItem('cssNotebook')));
            },

            createFirstCellGroup() {
                CellGroupManager.create('Welcome Example');
            },

            showWelcome() {
                const banner = document.getElementById('explanation');
                banner.classList.add('show');
                
                // Load a simple example to get users started
                setTimeout(() => {
                    TemplateManager.loadTemplate('body');
                }, 1000);
            },

            autoSave() {
                const state = AppState.save();
                console.log('Auto-saved notebook state:', state);
            }
        };

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            App.init();
        });
    </script>
</body>
</html>
                
